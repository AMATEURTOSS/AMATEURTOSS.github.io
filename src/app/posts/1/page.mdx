# 차세대 이미지 포멧 AVIF에 관하여

저는 개인적으로 만들어서 사용하는 이미지 클라우드 서비스가 있는데요.모든 이미지 파일을 **PNG**에서 **AVIF**로 전환했을 때 꽤나 큰 저장공간 절약이 있어서 공유하려고 합니다.

## AVIF란?

**AVIF**는 Alliance for Open Media에서 2019년에 개발한 차세대 이미지 포맷입니다.
기존의 **PNG**, **JPEG**과 같은 오래된 포맷은 물론 비교적 최근에 개발된 **WEBP**조차도 씹어먹을 정도의 고압축을 지원하여용량이 큰 이미지를 제공해야하는 서비스에는 참 감사한 포멧이라고 봐주시면 됩니다.

## PNG에서 AVIF로 전환하게된 계기

이미지를 **AVIF**로 전환하게되면 이미지의 크기가 줄어들게 될 것을 기대했고,
이미지의 크기가 줄어들면 이미지 로딩에 걸리는 시간이 줄어드니까 사용자 경험이 더 좋아질것이라고 생각했습니다. (google cloud storage 요금이 적게나오는 것도 하나의 이점이겠네요 ㅎㅎ)

## 전환과정

그냥 무식하게 gsutil로 이미지를 가져와서 image magick으로 포맷 전환,다시 업로드하는 스크립트를 작성하여 모든 이미지를 전환했습니다.
전체 이미지의 크기는 5GiB정도 되었는데, 이걸 전부 다운 -> 변환 -> 업로드 를 거치니 반나절정도가 소요되었고,금액은 1700원정도 청구되었습니다.

![google cloud storage 요금 통계표](/posts/1/1.png)

## 결과

결과는 꽤 만족스러웠습니다.원래 5GiB정도 되는 전체 스토리지 크기가 2GiB정도로 크게 줄어들었습니다.

![google cloud storage 용량 통계표](/posts/1/2.png)

(6월 7일에 기존 파일들이 전부 휴지통으로 들어가면서 스토리지 크기가 잠깐 커졌지만, 6월 27일 이후 다 삭제하면서 스토리지 크기가 2기가로 줄었습니다)

## 그래서 무조건 AVIF가 좋은것인가

지금껏 **AVIF**를 찬양하기는 했지만 **AVIF**도 물론 단점이 있습니다.

일단 호환성 문제입니다.2019년에 발표된 포맷이라 지원해주는 브라우저, 소프트웨어가 한정적입니다.

![avif 브라우저 호환 표](/posts/1/3.png)

[CanIUse에서 확인해봤을 때](https://caniuse.com/avif) 2022년도 이전에 나온 브라우저들은 지원못하고 있는것을 확인할 수 있습니다.
사실 이 문제는 HTML5의 picture 태그를 이용하면 해결할 수 있습니다.

```html
<picture>
  <source srcset="image.avif" type="image/avif">
  <img src="image.jpg" alt="이미지 설명">
</picture>
```

위와 같이 picture 태그를 사용하면 **AVIF**를 지원하는 브라우저에서는 **AVIF**를 보여주고,
지원하지 않는 브라우저에서는 **JPEG**를 보여줄 수 있습니다.

두 번째는 성능 문제입니다.
**AVIF**는 고압축 포맷이라 성능이 낮은 디바이스에서는 **JPEG**보다 더 느리게 렌더링될 수 있다고 합니다.

제가 이번에 포맷을 변경한 서비스는 저만 사용하기 때문에 과감하게 모든 이미지를 **AVIF**로 변환할 수 있었지만,
실무에서 사용하려면 트레이드 오프를 고려하여 신중히 결정해야할 것 같습니다.

## 결론

제 개인 프로젝트에서 **PNG** 이미지들을 **AVIF**로 전환하면서 **60%** 정도의 저장공간을 절약할 수 있었습니다.
저는 **AVIF**가 현재는 호환도 잘 안되고 유명하지 않은 포맷이지만 시간만 더 지난다면 **JPEG**과 같은 사실상의 표준 포맷을 제치고 신 표준의 자리에 앉을 수 있을것이라 믿어 의심치 않습니다.
컨텐츠 서빙에 대역폭을 많이 사용하고 있는 서비스들은 한번 **AVIF** 사용을 진지하게 고려해봐도 좋을 것 같습니다.
읽어주셔서 감사합니다.
